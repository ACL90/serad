---
title: "serad"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{serad}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Dernière mise à jour de cette documentation : 19 avril 2022.

```{r setup}
library(serad)
```


Le package **serad** (**S**ynthese d'**E**crits avec les **R**egles en vigueur **A** la **D**ares) fournit quelques fonctions facilitant l'écriture de textes dynamiques et respectant les règles de formattage de publications statistiques.

***
**Fonctions de base et formatage**

Les fonctions `serad::g(x1,x2)` et `serad::a(x1,x2,x3)` permettent d'obtenir une variation, ou une accélération, exprimée en pourcentage.
Elles se combinent avec la fonction `format_g` pour obtenir facilement le formatage idoine d'une variation (ou d'une accélération).
```{r }
#Astuce : il est possible d enlever le signe avec format_g(g,signe=0).
?format_g
```
Les autres fonctions de formatage sont :
```{r }
?format_niv   #pour un niveau
?format_delta #pour une diférence
```


**Comparaisons binaires**

Le plus souvent, on est simplement intéressé par la variation. La fonction générique qui fait cela est `comparaison(x1,x2,...)`.
```{r }
?comparaison
#Astuce : comparaison permet de modifier la marge (<0.05%) pour le cas d'egalite.
```
Les options de `comparaison` sont multiples, et ce qui a permis de créer facilement des fonctions dérivées très pratiques : `alahausse(x1,x2)`, `audessus(x1,x2)`, `davantage(x1,x2)`, `depasse(x1, x2, sing)`, `g_nom_simple(x1,x2)`... La liste s'allongera sûrement au fil des remontées d'utilisateurs.


**Comparaisons plus fines**

Pour nuancer l'ampleur de l'évolution, deux fonctions s'imposent tout d'abord : `g_nom(x1,x2)` -et son avatar `g_nom_taux(g)`- pour une évolution nominale, et `g_verbe(x1,x2)` -et son avatar `g_verbe_taux(g)`- pour une évolution verbale.
```{r }
?g_nom
?g_verbe
#Avancé : il est possible de paramétrer leurs seuils et sorties !
#NB : g_verbe(x1,x2) est désormais directement suivi du pourcentage.
```


**Comparaisons verbales tenant compte de la variation et de l'accélération**

Au plus raffiné (mais sans faire directement suivre de l'évolution), on peut avoir un verbe qui tient compte à la fois de la variation et de l'accélération. Cela est permis par `gETa_verbe(x1,x2,x3,sing)` - et son avatar `gETa_verbe_taux(g1,g2,sing)`.
```{r }
?gETa_verbe
#Avancé : il est possible de paramétrer les seuils et sorties !
#Expert : si la partition sous-jacente ne convient pas, contactez-nous.
```


***
**Autres**

`arrondi_tot(x,digit)` est à la base des fonctions de formattage, et est plus adapté à nos usages que `round`. Notablement, on peut tester :
```{r }
round(0.35,1)     #0.3 <!!>
arrondi_tot(0.35) #0.4 <:)>
```

Le pluriel n'advient en français que lorsqu'on atteint ou dépasse 2, ce que gère `s(a,sing,plur)` - privilégier la forme `serad::s(a,sing,plur)` :
```{r }
x=-1.4
paste(x,serad::s(x,"chat parle", "chats parlent"))
#Avec gestion (paramétrable) du cas limite où...
#un arrondi à 2 depuis l'inférieur, comme ci-dessous :
x=1.96
x_format = format_niv(x,detail=1)  #2.0
paste(x_format,serad::s(x,"chat parle", "chats parlent",seuil=1.95))
```


***
**Un exemple simpliste d'application... **
*à ne pas reproduire en l'état.*

```{r, echo=TRUE, include=TRUE  }
A <- data.frame(as.matrix(Seatbelts), date=time(Seatbelts))
   x1=dplyr::last(A$DriversKilled)
   x2=A$DriversKilled[length(A$law)-12]
   x168 = A$DriversKilled[168]
   
#En décembre `r trunc(dplyr::last(A$date))`, `r format_niv(x1)` 
#conducteurs d'automobiles sont décédes en Grande-Bretagne, soit 
#`r g_nom(x1,x2)` par rapport à 12 mois avant (`r format_g(serad::g(x1,x2))`,
#soit `r format_delta(x1-x2)` décès). Le niveau atteint 
#`r depasse(x1,x168,1)` celui de décembre 1982 - avant l'obligation 
#du port de la ceinture de sécurité (`r format_g(serad::g(x1,x168))`, soit 
#`r format_delta(x1-x168)` décès).
```
*Cela produit :*

En décembre `r trunc(dplyr::last(A$date))`, `r format_niv(x1)` conducteurs d'automobiles sont décédés en Grande-Bretagne, soit `r g_nom(x1,x2)` par rapport à 12 mois avant (`r format_g(serad::g(x1,x2))`, soit `r format_delta(x1-x2)` décès). Le niveau atteint `r depasse(x1,x168,1)` celui de décembre 1982 - avant l'obligation du port de la ceinture de sécurité (`r format_g(serad::g(x1,x168))`, soit `r format_delta(x1-x168)` décès).

```{r, echo=TRUE, include=TRUE }
   y1 = A$front[length(A$law)]
   y2 = A$front[length(A$law)-12]
   y3 = A$front[length(A$law)-24]
   z1 = A$rear[length(A$law)]
   z2 = A$rear[length(A$law)-12]
   
#En glissements annuels, le nombre de décès de passagers à l'avant 
#`r gETa_verbe(y1,y2,y3,1)` (`r format_g(serad::g(y1,y2))`, soit 
#`r format_delta(y1-y2)` décès, après `r format_g(serad::g(y2,y3))`, 
#soit `r format_delta(y2-y3)`).
#Le nombre de décès de passagers à l'arrière `r g_verbe(z1,z2,1)`
#(soit `r format_delta(y1-y2)` décès).
```
*Cela produit :*

En glissements annuels, le nombre de décès de passagers à l'avant `r gETa_verbe(y1,y2,y3,1)` (`r format_g(serad::g(y1,y2))`, soit `r format_delta(y1-y2)` décès, après `r format_g(serad::g(y2,y3))`, soit `r format_delta(y2-y3)`). Le nombre de décès de passagers à l'arrière `r g_verbe(z1,z2,1)` (soit `r format_delta(y1-y2)` décès).





